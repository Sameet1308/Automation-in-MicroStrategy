@echo off
setlocal enabledelayedexpansion

REM ==================== CONFIG (EDIT THESE IF NEEDED) ====================
REM PowerShell script location (UNC path; no mapped drives)
set PS_SCRIPT=\\prod.shsh.net\shhs\djdd\scripts\Convert-CsvUtf16ToUtf8.ps1

REM Folder where incoming CSVs arrive (UNC path)
set SHARED_PATH=\\prod.shsh.net\shhs\djdd\inbound

REM Which files to process
set FILE_PATTERN=Sales_*.csv

REM Local folder on the Windows AutoSys agent for logs
set LOG_ROOT=C:\AutoSys\logs\CsvUtfConvert

REM Output UTF-8 without BOM by default (switch to -Utf8Bom:$true if needed)
set UTF8_BOM_SWITCH=-Utf8Bom:$false

REM Optional behavior:
REM set PROCESS_ALL_SWITCH=-ProcessAll
REM set AGE_SWITCH=-MaxFileAgeHrs 24
REM =======================================================================

"%SystemRoot%\System32\WindowsPowerShell\v1.0\powershell.exe" -NoProfile -ExecutionPolicy Bypass -File "%PS_SCRIPT%" ^
  -SharedPath "%SHARED_PATH%" -FilePattern "%FILE_PATTERN%" -LogRoot "%LOG_ROOT%" ^
  %UTF8_BOM_SWITCH% %PROCESS_ALL_SWITCH% %AGE_SWITCH%

set RC=%ERRORLEVEL%
echo PowerShell returned %RC%
endlocal & exit /b %RC%